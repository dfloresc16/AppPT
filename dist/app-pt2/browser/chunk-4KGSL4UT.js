import{a as $}from"./chunk-64S5AWJR.js";import{$a as l,Ab as D,Bb as I,Cb as C,Db as d,Ia as f,Ka as a,Pa as s,Qa as r,Ra as h,Sa as w,Ta as M,Ua as x,Va as g,Za as c,aa as p,d as P,fb as m,mb as T,n as _,na as R,va as o,wa as S,z as b}from"./chunk-OZKSLEUV.js";var k=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=p({type:t,selectors:[["app-chat-message"]],inputs:{text:"text"},standalone:!0,features:[m],decls:6,vars:1,consts:[[1,"col-start-1","col-end-9","p-3","rounded-lg"],[1,"flex","flex-row","items-start"],[1,"flex","items-center","justify-center","h-10","w-10","rounded-full","bg-green-600","flex-shrink-0"],[1,"relative","ml-3","text-sm","bg-black","bg-opacity-25","pt-3","pb-2","px-4","shadow","rounded-xl"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),c(3," GPT "),r(),s(4,"div",3),c(5),r()()()),i&2&&(o(5),l(" ",n.text," "))},dependencies:[d],encapsulation:2,changeDetection:0})}}return t})();var A=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=p({type:t,selectors:[["app-my-message"]],inputs:{text:"text"},standalone:!0,features:[m],decls:6,vars:1,consts:[[1,"col-start-6","col-end-12","p-3","rounded-lg"],[1,"flex","items-center","justify-start","flex-row-reverse"],[1,"flex","items-center","justify-center","h-10","w-10","rounded-full","bg-indigo-500","flex-shrink-0"],[1,"relative","mr-3","text-sm","bg-black","bg-opacity-25","pt-3","pb-2","px-4","shadow","rounded-xl"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),c(3," F "),r(),s(4,"div",3),c(5),r()()()),i&2&&(o(5),l(" ",n.text," "))},dependencies:[d],encapsulation:2,changeDetection:0})}}return t})();var y=P($());function G(t,u){if(t&1&&(s(0,"span"),c(1),r()),t&2){let e=g();o(),l("Grabando: ",e.recordingTime," s")}}function H(t,u){if(t&1&&(s(0,"span"),c(1),r()),t&2){let e=g();o(),l("Tiempo total: ",e.recordingTime," s")}}var E=(()=>{class t{constructor(){this.messageCaptured=new R,this.audioChunks=[],this.transcript="",this.isRecording=!1,this.recordingTime=0,this.initializeSpeechRecognition()}initializeSpeechRecognition(){let e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.speechRecognition=new e,this.speechRecognition.lang="es-ES",this.speechRecognition.interimResults=!1,this.speechRecognition.onresult=i=>{this.transcript=i.results[0][0].transcript,console.log("Texto reconocido:",this.transcript)},this.speechRecognition.onspeechend=()=>{console.log("Silencio detectado, deteniendo la grabaci\xF3n."),this.stopRecording()},this.speechRecognition.onerror=i=>{console.error("Error al reconocer el audio:",i.error),this.stopRecording()}):console.error("SpeechRecognition API no est\xE1 disponible.")}startRecording(){_(navigator.mediaDevices.getUserMedia({audio:!0})).subscribe({next:i=>{if(this.mediaRecorder=new MediaRecorder(i),this.mediaRecorder.ondataavailable=n=>{this.audioChunks.push(n.data)},this.mediaRecorder.onstop=()=>{let n=new Blob(this.audioChunks,{type:"audio/wav"});this.audioChunks=[],this.convertAudioToText(n)},this.mediaRecorder.start(),this.isRecording=!0,this.startTimer(),this.showSwalAlertAutoClose("Grabaci\xF3n iniciada","La grabaci\xF3n ha comenzado.","info"),this.speechRecognition)try{this.speechRecognition.start()}catch{console.warn("El reconocimiento de voz ya estaba en ejecuci\xF3n.")}},error:i=>{console.error("Error al acceder al micr\xF3fono:",i)}})}stopRecording(){if(this.mediaRecorder){this.mediaRecorder.stop(),this.isRecording=!1,this.stopTimer();let e=this.transcript.trim()!==""?`Texto: ${this.transcript}`:"No se reconoci\xF3 ning\xFAn texto.";this.showSwalAlert("Grabaci\xF3n finalizada",`${e}
Duraci\xF3n: ${this.recordingTime} segundos`,"success"),this.transcript.trim()!==""&&this.messageCaptured.emit(this.transcript),this.transcript=""}this.speechRecognition&&this.speechRecognition.stop()}startTimer(){this.recordingTime=0,this.timerSubscription=b(1e3).subscribe(()=>{this.recordingTime++})}stopTimer(){this.timerSubscription&&this.timerSubscription.unsubscribe()}convertAudioToText(e){if(!this.speechRecognition){console.error("SpeechRecognition API no est\xE1 disponible.");return}}showSwalAlertAutoClose(e,i,n){y.default.fire({title:e,text:i,icon:n,timer:1e3,showConfirmButton:!1,allowOutsideClick:!0,backdrop:!1})}showSwalAlert(e,i,n){y.default.fire({title:e,text:i,icon:n,confirmButtonText:"Aceptar"})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=p({type:t,selectors:[["app-audio-message-box"]],outputs:{messageCaptured:"messageCaptured"},standalone:!0,features:[m],decls:7,vars:3,consts:[[1,"flex","items-center","justify-center","h-full"],[1,"flex","flex-col","items-center","space-y-4"],["type","button",1,"bg-red-500","text-white","p-6","rounded-full","hover:bg-red-600","transition","focus:outline-none","focus:ring-4","focus:ring-red-300",3,"click"],[3,"ngClass"],[1,"text-xl","font-medium","text-gray-800"],[4,"ngIf"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1)(2,"button",2),x("click",function(){return n.isRecording?n.stopRecording():n.startRecording()}),h(3,"i",3),r(),s(4,"div",4),f(5,G,2,1,"span",5)(6,H,2,1,"span",5),r()()()),i&2&&(o(3),a("ngClass",n.isRecording?"fa-solid fa-stop":"fa-solid fa-microphone"),o(2),a("ngIf",n.isRecording),o(),a("ngIf",!n.isRecording&&n.recordingTime>0))},dependencies:[d,D,C],encapsulation:2,changeDetection:0})}}return t})();function z(t,u){if(t&1&&h(0,"app-chat-message",6),t&2){let e=g().$implicit;a("text",e.text)}}function N(t,u){if(t&1&&h(0,"app-my-message",6),t&2){let e=g().$implicit;a("text",e.text)}}function O(t,u){if(t&1&&(w(0),f(1,z,1,1,"app-chat-message",5)(2,N,1,1,"app-my-message",5),M()),t&2){let e=u.$implicit;o(),a("ngIf",e.isGpt&&e.text.trim()!==""),o(),a("ngIf",!e.isGpt&&e.text.trim()!=="")}}var oe=(()=>{class t{constructor(e){this.cdr=e,this.messages=[]}addMessage(e,i){e.trim()!==""&&(this.messages.push({text:e,isGpt:i}),this.cdr.detectChanges())}trackByIndex(e){return e}static{this.\u0275fac=function(i){return new(i||t)(S(T))}}static{this.\u0275cmp=p({type:t,selectors:[["app-home-page"]],standalone:!0,features:[m],decls:5,vars:2,consts:[[1,"chat-container"],[1,"chat-messages"],[1,"grid","gap-y-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"messageCaptured"],[3,"text",4,"ngIf"],[3,"text"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),f(3,O,3,2,"ng-container",3),r()(),s(4,"app-audio-message-box",4),x("messageCaptured",function(F){return n.addMessage(F,!1)}),r()()),i&2&&(o(3),a("ngForOf",n.messages)("ngForTrackBy",n.trackByIndex))},dependencies:[d,I,C,k,A,E],encapsulation:2,changeDetection:0})}}return t})();export{oe as default};
